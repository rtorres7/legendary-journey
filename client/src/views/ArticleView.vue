<template>
  <template v-if="routerError">
    <NotFound />
  </template>
  <template v-else>
    <div>
      <ArticleNavigation :selectedArticle="selectedArticle"></ArticleNavigation>
    </div>
    <div
      class="
        flex flex-wrap
        md:flex-nowrap
        justify-between
        md:space-x-10
        lg:space-x-5
        mb-8
      "
    >
      <div class="flex flex-col space-y-4">
        <p class="font-semibold text-sm lg:text-md uppercase">article</p>
        <h1 class="font-semibold text-2xl lg:text-3xl">
          {{ articleDetails.title }}
        </h1>
        <div class="flex space-x-4 text-sm md:text-md">
          <p>PUBLISHED {{ dayjs(articleDetails.date_published).format("ddd, MMMM D, YYYY") }}</p>
          <p aria-hidden="true">‚óè</p>
          <p v-if="articleDetails.authors">{{ articleDetails.authors.join(", ") }}</p>
        </div>
        <!-- <img
          alt="article thumbnail"
          class="lg:w-4/5 max-h-96 w-full object-cover"
          :src="getImgUrl(selectedArticle.image.url)"
        /> -->
        <p class="italic text-sm">
          {{ articleDetails.image_caption }}
        </p>
        <p class="whitespace-pre-line" v-if="articleDetails.html_body">
          {{ articleDetails.html_body.join("\n\n") }}
        </p>
        <p
          class="
            italic
            border-t-2 border-slate-900/10
            dark:border-slate-50/[0.06]
            energy:border-zinc-700/25
            pt-4
          "
        >
          (U) For additional information:
        </p>
        <ul class="list-disc list-inside">
          <li v-for="index in 2" :key="index" class="italic text-sm">
            <router-link to="#" class="hover:underline">
              (U) This is the title for an article with additional information.
            </router-link>
          </li>
        </ul>
        <p
          class="
            font-semibold
            border-t-2 border-slate-900/10
            dark:border-slate-50/[0.06]
            energy:border-zinc-700/25
            pt-4
          "
        >
          Document Details
        </p>
        <Disclosure v-slot="{ open }">
          <DisclosureButton class="flex space-x-2 text-sm">
            <span>CONTENTS</span>
            <ChevronDownIcon
              class="h-4 w-4"
              :class="open ? 'transform rotate-180' : ''"
            />
          </DisclosureButton>
          <DisclosurePanel>
            <div class="ml-4 space-y-2 text-sm">
              <p><span class="font-semibold">Produced By: </span>{{ articleDetails.producing_office }}</p>
              <p><span class="font-semibold">Product Type: </span>{{ articleDetails.product_type_name }}</p>
              <p><span class="font-semibold">Document Number: </span>{{ articleDetails.doc_num }}</p>
              <p><span class="font-semibold">Posted: </span>{{ dayjs(articleDetails.posted_at).format("DD MMM YYYY hh:mm:ss") }}</p>
              <p><span class="font-semibold">Publication Date: </span>{{ dayjs(articleDetails.date_published).format("DD MMM YYYY") }}</p>
              <p><span class="font-semibold">Contact: </span>{{ articleDetails.poc_info }}</p>
            </div>
          </DisclosurePanel>
        </Disclosure>
        <Disclosure v-slot="{ open }">
          <DisclosureButton class="flex space-x-2 text-sm">
            <span>SOURCES</span>
            <ChevronDownIcon
              class="h-4 w-4"
              :class="open ? 'transform rotate-180' : ''"
            />
          </DisclosureButton>
          <DisclosurePanel>
            <ol class="list-decimal list-inside ml-4 space-y-2">
              <div v-for="source in articleDetails.sources" :key="source.name">
                <li class="text-sm">
                  <router-link to="#" class="hover:underline">
                    {{ source.name }}
                  </router-link>
                </li>
              </div>
            </ol>
          </DisclosurePanel>
        </Disclosure>
      </div>
    </div>
  </template>
</template>

<script>
import { ref } from "vue";
import { onMounted, computed } from "vue";
import { useStore } from "vuex";
import ArticleNavigation from "@/components/ArticleNavigation.vue";
import NotFound from "@/components/NotFound";
import {
  ChevronDownIcon,
} from "@heroicons/vue/outline";
import { Disclosure, DisclosureButton, DisclosurePanel } from "@headlessui/vue";
import { articles } from "@/data";
import * as dayjs from "dayjs";

export default {
  components: {
    ArticleNavigation,
    NotFound,
    ChevronDownIcon,
    Disclosure,
    DisclosureButton,
    DisclosurePanel,    
  },
  props: ["doc_num", "title"],
  setup() {
    const store = useStore();

    const comments = ref([]);
    const articleDetails = computed(() => store.state.danielDetails.document);
    const loadingDanielArticlesDetails = computed(() => store.state.danielDetails.loading);
    // const routerError = ref(true);

    const articlesData = ref(articles);
    const selectedArticle = ref();

    onMounted(() => {
      store.dispatch("danielDetails/getDanielArticlesDetails");
    });

    return {
      comments,
      articleDetails,
      loadingDanielArticlesDetails,
      // routerError,
      dayjs,
      
      articlesData,
      selectedArticle,
    };
  },
  // beforeRouteEnter(to, from, next) {
  //   next((vm) => {
  //     vm.selectedArticle = vm.getArticle(to.params.doc_num);
  //     if (vm.selectedArticle) {
  //       vm.routerError = false;
  //     } else {
  //       vm.routerError = true;
  //     }
  //   });
  // },
  // beforeRouteUpdate(to) {
  //   this.selectedArticle = this.getArticle(to.params.doc_num);
  //   if (this.selectedArticle) {
  //     this.routerError = false;
  //   } else {
  //     this.routerError = true;
  //   }
  // },
  methods: {
    getArticle(doc_num) {
      return this.articlesData.find((article) => article.doc_num === doc_num);
    },
    addComment(comment) {
      this.comments.push(comment);
    },
    getImgUrl(url) {
      return require("@/assets/" + url);
    },
    setTitle(str) {
      document.title = `${str}`;
    },
  },
  updated() {
    if (this.selectedArticle && this.selectedArticle.title) {
      this.setTitle(this.selectedArticle.title);
    } else {
      this.setTitle("Page not found");
    }
  },  
};
</script>

<style lang="scss" scoped></style>
